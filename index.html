<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>عد تنازلي</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#60a5fa;--muted:#94a3b8}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{display:flex;align-items:center;justify-content:center;background:#071029;color:#edf2f7;overflow:hidden}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:28px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6);width:min(680px,94vw);text-align:center;position:relative;z-index:2}
    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .timer{display:flex;gap:12px;justify-content:center;align-items:center}
    .unit{background:rgba(255,255,255,0.03);padding:14px 18px;border-radius:10px;min-width:84px}
    .num{font-size:30px;font-weight:700;letter-spacing:0.6px}
    .label{font-size:12px;color:var(--muted);margin-top:6px}
    .small{font-size:12px;color:var(--muted);margin-top:10px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;justify-content:center;margin-top:14px;flex-wrap:wrap}
    .btn{border:0;padding:8px 12px;border-radius:8px;background:#0b2440;color:#fff;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    #bgCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;display:block}
    @media (max-width:420px){.unit{min-width:62px;padding:10px}}
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>

  <div class="card" role="main">
    <h1 id="title">الوقت المتبقي عشان ابوسك يا قمر القمرات</h1>
    <p class="lead" id="subtitle">أحلى مسى على فخادك يا أم ياسين.</p>

    <div class="timer" aria-live="polite">
      <div class="unit">
        <div class="num" id="days">0</div>
        <div class="label">أيام</div>
      </div>
      <div class="unit">
        <div class="num" id="hours">00</div>
        <div class="label">ساعات</div>
      </div>
      <div class="unit">
        <div class="num" id="minutes">00</div>
        <div class="label">دقائق</div>
      </div>
      <div class="unit">
        <div class="num" id="seconds">00</div>
        <div class="label">ثواني</div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="copyLink">نسخ رابط الصفحة</button>
      <button class="btn secondary" id="openNow">فتح الآن (عرض الوقت المحلي)</button>
      <button class="btn secondary" id="toggleMusic">تشغيل/إيقاف الموسيقى</button>
    </div>

    <div class="small">التاريخ والوقت المستهدف: <span id="targetLabel"></span></div>
    <footer>الوقت المتبقي عشان اشوفك يا قمر</footer>
  </div>

  <!-- موسيقى خلفية من الإنترنت -->
  <audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    متصفحك لا يدعم تشغيل الصوت.
  </audio>

<script>
(function(){
  // التاريخ والوقت المستهدف
  const TARGET_ISO = "2025-12-11T19:30:00+02:00";

  const params = new URLSearchParams(location.search);
  const targetIso = params.get("target") || TARGET_ISO;

  let targetDate = new Date(targetIso);
  const targetLabel = document.getElementById("targetLabel");
  if (isNaN(targetDate)){
    targetLabel.textContent = "تنسيق غير صالح: " + targetIso; 
    return; 
  }
  targetLabel.textContent = targetDate.toUTCString();

  const els = {
    days: document.getElementById("days"),
    hours: document.getElementById("hours"),
    minutes: document.getElementById("minutes"),
    seconds: document.getElementById("seconds"),
    title: document.getElementById("title"),
    subtitle: document.getElementById("subtitle")
  };

  const bgMusic = document.getElementById('bgMusic');
  document.getElementById('toggleMusic').addEventListener('click', () => {
    if(bgMusic.paused) bgMusic.play().catch(()=>{}); else bgMusic.pause();
  });

  function pad(n){ return n<10 ? "0"+n : n; }
  function playEndSound() {
    const endSound = new Audio('https://www.soundjay.com/button/beep-07.mp3');
    endSound.play();
  }

  function update(){
    const now = new Date();
    const diff = targetDate.getTime() - now.getTime();

    if (diff <= 0){
      els.days.textContent = "0";
      els.hours.textContent = "00";
      els.minutes.textContent = "00";
      els.seconds.textContent = "00";
      els.title.textContent = "انتهى العد التنازلي";
      els.subtitle.textContent = "وصلنا للوقت المستهدف.";
      playEndSound();
      clearInterval(timer);
      return;
    }

    const sec = Math.floor(diff / 1000);
    const days = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const minutes = Math.floor((sec % 3600) / 60);
    const seconds = sec % 60;

    els.days.textContent = days;
    els.hours.textContent = pad(hours);
    els.minutes.textContent = pad(minutes);
    els.seconds.textContent = pad(seconds);
  }

  document.getElementById('copyLink').addEventListener('click', async ()=>{
    try{
      const u = new URL(location.href);
      if(!u.searchParams.get('target')) u.searchParams.set('target', targetIso);
      await navigator.clipboard.writeText(u.toString());
      alert('تم نسخ الرابط إلى الحافظة');
    }catch(e){ prompt('انسخ الرابط يدويًا:', location.href); }
  });

  document.getElementById('openNow').addEventListener('click', ()=>{
    alert('الوقت الآن (محلي): ' + new Date().toString() + '\nالهدف (UTC): ' + targetDate.toUTCString());
  });

  update();
  const timer = setInterval(update,1000);

  // ======== خلفية النجوم المتحركة + gradient ديناميكي ========
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const stars = [];
  const numStars = 100;
  for(let i=0;i<numStars;i++){
    stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.5+0.5,speed:Math.random()*0.5+0.2});
  }

  window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});

  function animateStars(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const now = new Date();
    const diff = targetDate.getTime() - now.getTime();
    let gradColor = `rgba(${Math.min(255, diff/1000)},${Math.min(255, diff/2000)},255,0.2)`;
    ctx.fillStyle = gradColor;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle='white';
    stars.forEach(star=>{
      ctx.beginPath();
      ctx.arc(star.x,star.y,star.r,0,Math.PI*2);
      ctx.fill();
      star.y+=star.speed;
      if(star.y>canvas.height) star.y=0;
    });

    requestAnimationFrame(animateStars);
  }

  animateStars();

})();
</script>
</body>
</html>
